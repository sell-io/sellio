<% content_for :title, "My Listings - Dealo" %>

<div class="my-listings-page">
  <div class="container">
    <div class="page-header">
      <h1>My Listings</h1>
      <p>Manage your posted ads</p>
      <%= link_to "Post New Ad", new_listing_path, class: "btn-post-new" %>
    </div>

    <% if user_signed_in? && current_user.is_verified? %>
      <div class="free-boosts-banner">
        <span class="free-boosts-banner-label">Free ad boosts this month:</span>
        <span class="free-boosts-banner-count"><%= current_user.free_boosts_remaining %> of <%= User::FREE_BOOSTS_PER_MONTH %> left</span>
        <% if current_user.free_boosts_reset_on.present? %>
          <span class="free-boosts-banner-reset">(resets <%= current_user.free_boosts_reset_on %>)</span>
        <% end %>
      </div>
    <% end %>

    <% if @listings.any? %>
      <div class="listings-grid">
        <% @listings.each do |listing| %>
          <div class="listing-card<%= ' listing-card-boosted' if listing.boosted? %>">
            <div class="listing-image">
              <% if listing.images.attached? %>
                <%= image_tag listing.ordered_images.first, class: "listing-card-image" %>
              <% else %>
                <div class="image-placeholder">
                  <span>üì∑</span>
                </div>
              <% end %>
            </div>
            <div class="listing-content">
              <% if listing.boosted? %>
              <p class="listing-boosted-time"><span class="listing-badge-boosted">Boosted<%= listing.boost_time_left ? " (#{listing.boost_time_left})" : "" %></span></p>
              <% end %>
              <h3 class="listing-title">
                <%= link_to listing.title, listing, class: "listing-link" %>
              </h3>
              <p class="listing-location">üìç <%= listing.city || "Location not specified" %></p>
              <div class="listing-footer">
                <span class="listing-price">
                  <% if listing.price %>
                    ‚Ç¨<%= number_with_delimiter(listing.price.to_i) %>
                  <% else %>
                    Price on request
                  <% end %>
                </span>
                <div class="listing-actions">
                  <%= link_to "Edit", edit_listing_path(listing), class: "btn-edit-small" %>
                  <%= link_to "View", listing, class: "btn-view" %>
                  <% unless listing.boosted? %>
                    <% if current_user.is_verified? && current_user.free_boosts_remaining > 0 %>
                      <%= link_to "Free boost (#{current_user.free_boosts_remaining})", boost_listing_path(listing.id), class: "btn-boost-small", data: { turbo: "false" } %>
                    <% else %>
                      <%= link_to "Boost", boost_listing_path(listing.id), class: "btn-boost-small", data: { turbo: "false" } %>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <p>You haven't posted any listings yet.</p>
        <%= link_to "Post Your First Ad", new_listing_path, class: "btn-cta" %>
      </div>
    <% end %>
  </div>
</div>
