<% content_for :title, "My Saved Ads" %>

<div class="listings-container">
  <div class="listings-header">
    <h1>My Saved Ads</h1>
    <p class="listings-subtitle">Your favorite listings</p>
  </div>

  <% if @favorites.any? %>
    <div class="listings-grid">
      <% @favorites.each do |favorite| %>
        <% listing = favorite.listing %>
        <div class="listing-card">
          <%= link_to listing_path(listing), class: "listing-card-link" do %>
            <div class="listing-image-container">
              <% if listing.images.attached? %>
                <% first_image = listing.ordered_images.first %>
                <%= image_tag listing.image_listing(first_image), 
                              class: "listing-image",
                              srcset: {
                                listing.image_thumb(first_image) => "400w",
                                listing.image_listing(first_image) => "800w"
                              },
                              sizes: "(max-width: 768px) 50vw, 300px",
                              loading: "lazy",
                              alt: listing.title %>
              <% else %>
                <div class="image-placeholder">
                  <span>ğŸ“·</span>
                </div>
              <% end %>
            </div>
            <div class="listing-info">
              <h3 class="listing-title"><%= listing.title %></h3>
              <div class="listing-meta">
                <% subcategory = listing.extra_fields&.dig('subcategory') %>
                <% if subcategory.present? %>
                  <span class="subcategory-badge"><%= subcategory %></span>
                <% elsif listing.category %>
                  <span class="category-badge"><%= listing.category.name %></span>
                <% end %>
                <span class="listing-date"><%= time_ago_in_words(listing.created_at) %> ago</span>
              </div>
              <div class="listing-price">
                <% if listing.price %>
                  â‚¬<%= number_with_delimiter(listing.price.to_i) %>
                <% else %>
                  Price on request
                <% end %>
              </div>
              <div class="listing-location">
                ğŸ“ <%= listing.city || "Location not specified" %>
              </div>
            </div>
          <% end %>
          <% if user_signed_in? %>
            <div class="favorite-heart-container" data-listing-id="<%= listing.id %>" data-favorite-id="<%= favorite.id %>">
              <button class="favorite-heart-btn favorite-heart-active" 
                      data-listing-id="<%= listing.id %>"
                      data-favorited="true"
                      data-favorite-id="<%= favorite.id %>"
                      title="Remove from favorites">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
              </button>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <div class="empty-state-icon">â­</div>
      <h2>No saved ads yet</h2>
      <p>Start saving your favorite listings to view them here!</p>
      <%= link_to "Browse Listings", listings_path, class: "btn-primary" %>
    </div>
  <% end %>
</div>
